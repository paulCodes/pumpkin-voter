{% extends "base.html" %}

{% block header %}Dashboard{% endblock %}

{% block main %}

<div class="uk-grid uk-text-center">
    <div class="uk-width-1-2@s">
        <canvas id="chart1" width="400" height="200"></canvas>
        <h4 class="uk-margin-remove">All Usages</h4>
        <span class="uk-text-muted">Past 7 Days</span>
    </div>
    <div class="uk-width-1-2@s">
        <canvas id="chart2" width="400" height="200"></canvas>
        <h4 class="uk-margin-remove">All Usages</h4>
        <span class="uk-text-muted">Past 24 Hours</span>
    </div>
</div>

<div class="uk-grid">
    <div class="uk-width-1-1">
        <h2>Recent Requests</h2>

        <div class="uk-overflow-auto">
            <table class="uk-table uk-table-striped">
            <thead>
            <tr>
                <th>License Key</th>
                <th>Client</th>
                <th>When</th>
            </tr>
            </thead>
            <tbody>
            {% for rr in recentRequests %}
            <tr>
                <td>{{ rr }} {{ rr.License.Tag }}</td>
                <td>{{ rr.Usage.UsageIdentifier }}</td>
                <td>{{ rr.When }} ago</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
</div>


{% endblock %}

{% block body_js %}
<script type="text/javascript">
    var data = {
        labels: {{ labels7DaysJson|safe }},
        datasets: [
            {
                label: "",
                fillColor: "rgba(151,187,205,0.2)",
                strokeColor: "rgba(151,187,205,1)",
                pointColor: "rgba(151,187,205,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(151,187,205,1)",
                data: {{ data7DaysJson|safe }}
            }
        ]};
    var ctx = $("#chart1").get(0).getContext("2d");
    // This will get the first returned node in the jQuery collection.
    var new_chart = new Chart(ctx).Line(data, {
        bezierCurve: false,
        pointHitDetectionRadius: 3,
    });

    var data = {
        labels: {{ labels24HoursJson|safe }},
        datasets: [
            {
                label: "",
                fillColor: "rgba(151,187,205,0.2)",
                strokeColor: "rgba(151,187,205,1)",
                pointColor: "rgba(151,187,205,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(151,187,205,1)",
                data: {{ data24HoursJson }}
            }
        ]};
    var ctx = $("#chart2").get(0).getContext("2d");
    // This will get the first returned node in the jQuery collection.
    var new_chart = new Chart(ctx).Line(data, {
        bezierCurve: false,
        pointHitDetectionRadius: 3,
    });
</script>
{% endblock %}
